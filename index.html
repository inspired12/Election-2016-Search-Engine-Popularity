<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title></title>
<style>

    .ui{
        font-family: sans-serif;
        margin-left:3em;
    }

    rect{
        fill:#B22234;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }

</style>
</head>
<body>

<img src="img/flag.svg">

<div class="ui">
	<h1>Week of 12/28/2014 
    </h1>
</div>

<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js'></script>
<script>

var margin = {top: 20, right: 10, bottom: 130, left: 120}, 
   width = window.innerWidth*0.9 - margin.left - margin.right,
	height = 600 - margin.top - margin.bottom;

var widthScale = d3.scale.ordinal()
                    .range([ 0, width ]);

var heightScale = d3.scale.ordinal()
                    .rangeRoundBands([ 0, height ], 0.1);

var x = d3.scale.ordinal().rangePoints([0, width],1),
y = {};

var axis = d3.svg.axis().orient("left");

var svg = d3.select('body').append('svg')
	.attr('width', width + margin.left + margin.right)
	.attr('height', height + margin.top + margin.bottom)
    .append('g')
	.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

var _root = [];
var weekCount = 0;

d3.csv("data.csv",function(root){
    root.forEach(function(data){
        for(var k in data){
            if (data.hasOwnProperty(k)) {
                if(k=="Week"){
                   var week = {"week":data[k],"ranks":[]};
                }else{
                   week["ranks"].push({"name":k,"rank":+data[k]});
                }
            }
        }
        _root.push(week);
    })

    update();

});

function nextWeek(e){

    e.preventDefault();


}

function update(_data){

    x.domain(dimensions = d3.keys(_root).filter(function(d){ 
        return true && (y[d] = d3.scale.ordinal().domain(_root[d].ranks.map(function(j) { return j.name.split(" ")[1]; } )).rangeRoundBands([ 0, height ], 0.1))
    }));

console.log(y);

 // Add a group element for each dimension.
  var g = svg.selectAll(".dimension")
      .data(dimensions)
    .enter().append("g")
      .attr("class", "dimension")
      .attr("transform", function(d) { return "translate(" + x(d) + ")"; });

  // Add an axis and title.
  g.append("g")
      .attr("class", "axis")
      .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
    .append("text")
      .style("text-anchor", "middle")
      .attr("y", -9)
      .text(function(d) { return _root[d].week; });

    svg.select(".x.axis").remove();
    svg.select(".y.axis").remove();


}

</script>
</body>
</html>

